<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç©åˆ†ã‚¬ãƒãƒ£</title>

<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$']] },
  startup: { typeset: false }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" defer></script>

<style>
body { font-family: system-ui, sans-serif; background:#f5f5f5; padding:16px; }
.container { max-width:480px; margin:auto; background:#fff; padding:16px; border-radius:12px; }
button, select, input { width:100%; padding:10px; font-size:1.1rem; margin-top:10px; }
button { background:#4f46e5; color:#fff; border:none; border-radius:8px; }
button.sub { background:#16a34a; }
.box { margin-top:16px; font-size:1.2rem; min-height:2em; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #ccc; padding:4px; text-align:left; font-size:0.95rem; }
</style>
</head>

<body>
<div class="container">
  <h1>ğŸ² ç©åˆ†ã‚¬ãƒãƒ£</h1>

  <!-- é€šå¸¸ã‚¬ãƒãƒ£ -->
  <select id="level">
    <option value="easy">â˜… æ˜“ã—ã„</option>
    <option value="normal">â˜…â˜… æ™®é€š</option>
    <option value="hard">â˜…â˜…â˜… é›£ã—ã„</option>
  </select>
  <button onclick="spin()">ğŸ² ã‚¬ãƒãƒ£ã‚’å›ã™</button>
  <div id="question" class="box"></div>
  <div id="answer" class="box" style="display:none;"></div>

  <!-- 5å•ã¾ã¨ã‚å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ -->
  <button onclick="startStudyBatch()">ğŸ“˜ 5å•ã¾ã¨ã‚å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰</button>
  <div id="studyBatch" class="box"></div>

  <!-- ã‚ªãƒªã‚¸ãƒŠãƒ«å•é¡Œè¿½åŠ UI -->
  <h2>ğŸ“ ã‚ªãƒªã‚¸ãƒŠãƒ«å•é¡Œç·¨é›†</h2>
  <input id="newQ" placeholder="å•é¡Œæ–‡ q">
  <input id="newA" placeholder="ç­”ãˆ a">
  <select id="newLevel">
    <option value="easy">easy</option>
    <option value="normal">normal</option>
    <option value="hard">hard</option>
  </select>
  <button onclick="addQuestion()">è¿½åŠ </button>

  <table id="qTable">
    <thead><tr><th>é›£æ˜“åº¦</th><th>å•é¡Œ</th><th>ç­”ãˆ</th><th>å‰Šé™¤</th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<script>
/* ===== å†…éƒ¨JSON ===== */
let questionDB = {
  easy:[
    {q:"\\int \\sin x\\,dx",a:"-\\cos x + C"},
    {q:"\\int \\frac{1}{x}\\,dx",a:"\\log|x| + C"}
  ],
  normal:[
    {q:"\\int_0^\\pi \\sin x\\,dx",a:"2"},
    {q:"\\int_1^e \\log x\\,dx",a:"1"}
  ],
  hard:[
    {q:"\\int_0^\\pi x\\sin x\\,dx",a:"\\pi"}
  ]
};

/* ===== å…±é€š ===== */
function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
function generateFromJSON(level){
  const list = questionDB[level];
  return list[Math.floor(Math.random()*list.length)];
}

/* ===== è‡ªå‹•ç”Ÿæˆ ===== */
function generateAuto(level){
  if(level==="easy"){
    const t=randInt(1,3),a=randInt(1,5);
    if(t===1) return {q:`\\int \\sin(${a}x)\\,dx`,a:`-\\frac{1}{${a}}\\cos(${a}x)+C`};
    if(t===2) return {q:`\\int \\cos(${a}x)\\,dx`,a:`\\frac{1}{${a}}\\sin(${a}x)+C`};
    return {q:`\\int \\frac{1}{x}\\,dx`,a:`\\log|x|+C`};
  }
  if(level==="normal"){
    if(Math.random()<0.5) return {q:"\\int_1^e \\log x\\,dx",a:"1"};
    const a=randInt(1,4);
    return {q:`\\int_0^\\pi \\sin(${a}x)\\,dx`,a:`\\frac{2}{${a}}`};
  }
  const a=randInt(1,3);
  return {q:`\\int_0^\\pi x\\sin(${a}x)\\,dx`,a:`\\frac{\\pi}{${a}}`};
}

/* ===== ç”Ÿæˆãƒ¡ã‚¤ãƒ³ ===== */
function generate(level){
  if(Math.random()<0.5) return generateFromJSON(level);
  return generateAuto(level);
}

/* ===== é€šå¸¸ã‚¬ãƒãƒ£ ===== */
function spin(){
  const level=document.getElementById("level").value;
  const p=generate(level);
  document.getElementById("question").innerHTML=`$$${p.q}$$`;
  document.getElementById("answer").innerHTML=`$$${p.a}$$`;
  document.getElementById("answer").style.display="none";
  MathJax.typesetPromise();
}

/* ===== 5å•ã¾ã¨ã‚å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ ===== */
function startStudyBatch(){
  const studyLevels=["easy","easy","normal","normal","hard"];
  const container=document.getElementById("studyBatch");
  container.innerHTML="";

  studyLevels.forEach((level,i)=>{
    const p=generate(level);
    const div=document.createElement("div");
    div.style.border="1px solid #ccc";
    div.style.padding="8px";
    div.style.marginBottom="8px";

    div.innerHTML=`
      <strong>${i+1}/5ï½œ${level.toUpperCase()}</strong><br>
      <span class="question">$$${p.q}$$</span>
      <div style="margin-top:4px;">
        <button class="showAnswer">ğŸ‘€ ç­”ãˆè¡¨ç¤º</button>
        <div class="answer" style="display:none;">$$${p.a}$$</div>
      </div>
    `;
    container.appendChild(div);
  });

  MathJax.typesetPromise().then(()=>{
    container.querySelectorAll(".showAnswer").forEach(btn=>{
      btn.addEventListener("click",()=>{
        const ansDiv=btn.nextElementSibling;
        if(ansDiv.style.display==="none"){ ansDiv.style.display="block"; MathJax.typesetPromise(); }
        else { ansDiv.style.display="none"; }
      });
    });
  });
}

/* ===== ã‚ªãƒªã‚¸ãƒŠãƒ«å•é¡Œç·¨é›† ===== */
function refreshTable(){
  const tbody=document.querySelector("#qTable tbody");
  tbody.innerHTML="";
  ["easy","normal","hard"].forEach(level=>{
    questionDB[level].forEach((q,i)=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${level}</td>
                    <td>${q.q}</td>
                    <td>${q.a}</td>
                    <td><button onclick="deleteQuestion('${level}',${i})">å‰Šé™¤</button></td>`;
      tbody.appendChild(tr);
    });
  });
}

function addQuestion(){
  const q=document.getElementById("newQ").value;
  const a=document.getElementById("newA").value;
  const level=document.getElementById("newLevel").value;
  if(q && a){
    questionDB[level].push({q,a});
    refreshTable();
    document.getElementById("newQ").value="";
    document.getElementById("newA").value="";
  }
}

function deleteQuestion(level,index){
  questionDB[level].splice(index,1);
  refreshTable();
}

// åˆæœŸè¡¨ç¤º
refreshTable();
</script>

</body>
</html>
